<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Code and Iron Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- FONT -->
  <style>
    @font-face {
      font-family: "CodeAndIron";
      src: url("fonts/CodeAndIron.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }

    :root {
      --bg: #050506;
      --card: #111115;
      --card-inner: #18181f;
      --card-innermost: #1f1f27;
      --accent-blue: #0b82ff;
      --accent-red: #e03b34;
      --accent-gold: #ffb53a;
      --text-main: #f5f5ff;
      --text-muted: #a0a0b2;
      --input-bg: #050506;
      --input-border: #2a2a33;
      --radius-xl: 32px;
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.7);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top left, #151521 0, #050506 55%);
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    .app {
      max-width: 480px;               /* tighter width like screenshot 1 */
      margin: 0 auto;
      padding: 20px 16px 40px;
    }

    /* HEADER / TITLE + MENU */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .app-title {
      font-family: "CodeAndIron", system-ui, sans-serif;
      font-size: 32px;
      letter-spacing: 0.03em;
      margin: 0;
      line-height: 1.15;
    }

    .menu-toggle {
      width: 48px;
      height: 48px;
      border-radius: 18px;
      border: none;
      background: rgba(15, 15, 20, 0.95);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.7);
      padding: 0;
    }

    .menu-toggle span {
      display: block;
      width: 22px;
      height: 2px;
      border-radius: 999px;
      background: #f7f7ff;
      position: relative;
    }

    .menu-toggle span::before,
    .menu-toggle span::after {
      content: "";
      position: absolute;
      left: 0;
      width: 22px;
      height: 2px;
      border-radius: 999px;
      background: #f7f7ff;
    }

    .menu-toggle span::before {
      top: -6px;
    }
    .menu-toggle span::after {
      top: 6px;
    }

    /* DROPDOWN MENU */
    .menu {
      position: absolute;
      right: 20px;
      top: 70px;
      background: rgba(11, 11, 15, 0.97);
      border-radius: 20px;
      padding: 10px 0;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.85);
      min-width: 170px;
      display: none;
      z-index: 40;
    }

    .menu.open {
      display: block;
    }

    .menu-item {
      width: 100%;
      padding: 10px 18px;
      text-align: left;
      background: transparent;
      color: var(--text-main);
      border: none;
      font-size: 16px;
      font-weight: 500;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, 0.06);
    }

    /* PAGES */
    .page {
      display: none;
    }
    .page.active {
      display: block;
    }

    /* OUTER CARD STACK */
    .card-outer {
      background: rgba(8, 8, 12, 0.9);
      border-radius: var(--radius-xl);
      padding: 18px 18px 26px;
      box-shadow: var(--shadow-soft);
    }

    .card-mid {
      background: rgba(22, 22, 30, 0.9);
      border-radius: 28px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.02);
    }

    .card-inner {
      background: rgba(16, 16, 24, 0.96);
      border-radius: 24px;
      padding: 18px 16px 20px;
      border: 1px solid rgba(255, 255, 255, 0.03);
    }

    .section-title {
      font-size: 26px;
      margin: 0 0 14px;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .section-title span {
      font-family: "CodeAndIron", system-ui, sans-serif;
    }

    /* TODAY LAYOUT */
    .exercise-card {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .exercise-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .exercise-input {
      flex: 1;
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-main);
      font-size: 16px;
    }

    .exercise-input::placeholder {
      color: var(--text-muted);
    }

    .exercise-actions {
      display: flex;
      gap: 8px;
    }

    .icon-circle {
      width: 64px;
      height: 64px;
      border-radius: 999px;
      border: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: 600;
      color: #fff;
      box-shadow: 0 14px 35px rgba(0, 0, 0, 0.7);
    }

    .icon-circle.red {
      background: var(--accent-red);
    }

    .icon-circle.blue {
      background: var(--accent-blue);
    }

    /* SET ROW */
    .set-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 2px;
    }

    .set-label {
      font-family: "CodeAndIron", system-ui, sans-serif;
      font-size: 20px;
      color: var(--accent-gold);
      min-width: 62px;
    }

    .set-fields {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      justify-content: flex-start;
    }

    .chip-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: center;
    }

    .chip-label {
      font-family: "CodeAndIron", system-ui, sans-serif;
      letter-spacing: 0.05em;
      font-size: 14px;
      color: var(--text-muted);
    }

    .chip-input {
      width: 70px;
      height: 70px;
      border-radius: 999px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-main);
      text-align: center;
      font-size: 18px;
      font-weight: 600;
    }

    .chip-input::placeholder {
      color: var(--text-muted);
    }

    .set-actions {
      display: flex;
      gap: 8px;
      margin-left: auto;
    }

    .icon-circle.small {
      width: 56px;
      height: 56px;
      font-size: 24px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
    }

    /* ROUTINES PAGE */
    .routines-card {
      margin-top: 18px;
    }

    .routines-header {
      margin-bottom: 14px;
    }

    .routines-title {
      font-size: 26px;
      margin: 0 0 6px;
      font-family: "CodeAndIron", system-ui, sans-serif;
    }

    .routines-subtitle {
      margin: 0;
      font-size: 14px;
      color: var(--text-muted);
    }

    .routine-name-input {
      width: 100%;
      padding: 12px 18px;
      margin: 14px 0 10px;
      border-radius: 999px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-main);
      font-size: 16px;
    }

    .routine-name-input::placeholder {
      color: var(--text-muted);
    }

    .primary-btn {
      width: 100%;
      padding: 13px 16px;
      border-radius: 999px;
      border: none;
      background: var(--accent-blue);
      color: #fff;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 18px;
      box-shadow: 0 16px 38px rgba(0, 112, 255, 0.6);
    }

    .saved-routines {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .routine-block {
      background: rgba(16, 16, 24, 0.96);
      border-radius: 24px;
      padding: 14px 14px 16px;
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .routine-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .routine-name {
      font-size: 18px;
      font-weight: 600;
    }

    .routine-actions {
      display: flex;
      gap: 8px;
    }

    .pill-btn {
      border-radius: 999px;
      padding: 6px 13px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      color: #fff;
    }

    .pill-btn.green {
      background: #21a45b;
    }

    .pill-btn.blue {
      background: #0b82ff;
    }

    .pill-btn.red {
      background: #e03b34;
    }

    .back-link {
      margin: 22px 4px 0;
      color: var(--text-main);
      text-decoration: none;
      font-size: 16px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .back-link span {
      font-size: 20px;
      line-height: 1;
    }

    /* UTILITIES */
    button {
      font-family: inherit;
    }

    button:active {
      transform: translateY(1px);
    }

    input {
      outline: none;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header class="app-header">
      <h1 class="app-title">Code and Iron Test</h1>
      <button id="menuToggle" class="menu-toggle" aria-label="Menu">
        <span></span>
      </button>

      <div id="menu" class="menu">
        <!-- NOTE: only Routines; Today/Home removed -->
        <button class="menu-item" data-target="routines">Routines</button>
      </div>
    </header>

    <!-- TODAY PAGE -->
    <main>
      <section id="todayPage" class="page active">
        <div class="card-outer">
          <div class="card-mid">
            <div class="card-inner">
              <h2 class="section-title"><span>Today</span></h2>
              <div id="exerciseList"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ROUTINES PAGE -->
      <section id="routinesPage" class="page">
        <div class="card-outer routines-card">
          <div class="card-mid">
            <div class="card-inner">
              <div class="routines-header">
                <h2 class="routines-title">Routines</h2>
                <p class="routines-subtitle">
                  Save exercise groups you can quickly load into Today.
                </p>
              </div>

              <input
                id="newRoutineName"
                class="routine-name-input"
                type="text"
                placeholder="e.g. Push Day, Legs, Back &amp; Biceps"
              />
              <button id="saveRoutineBtn" class="primary-btn">
                Save routine
              </button>

              <div id="savedRoutines" class="saved-routines"></div>

              <a href="#" id="backToToday" class="back-link">
                <span>←</span> Back to logger
              </a>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- SCRIPT -->
  <script>
    // ===== BASIC HELPERS =====
    const todayPage = document.getElementById("todayPage");
    const routinesPage = document.getElementById("routinesPage");
    const exerciseList = document.getElementById("exerciseList");

    // ===== NAV MENU =====
    const menuToggle = document.getElementById("menuToggle");
    const menu = document.getElementById("menu");
    const backToToday = document.getElementById("backToToday");

    menuToggle.addEventListener("click", () => {
      menu.classList.toggle("open");
    });

    document.addEventListener("click", (e) => {
      if (
        !menu.contains(e.target) &&
        !menuToggle.contains(e.target)
      ) {
        menu.classList.remove("open");
      }
    });

    menu.addEventListener("click", (e) => {
      const btn = e.target.closest(".menu-item");
      if (!btn) return;

      const target = btn.dataset.target;
      if (target === "routines") {
        showRoutines();
      }
      menu.classList.remove("open");
    });

    backToToday.addEventListener("click", (e) => {
      e.preventDefault();
      showToday();
    });

    function showToday() {
      todayPage.classList.add("active");
      routinesPage.classList.remove("active");
    }

    function showRoutines() {
      routinesPage.classList.add("active");
      todayPage.classList.remove("active");
      renderSavedRoutines();
    }

    // ===== TODAY LOGIC =====
    function createExerciseCard() {
      const card = document.createElement("div");
      card.className = "exercise-card";

      card.innerHTML = `
        <div class="exercise-row">
          <input type="text" class="exercise-input" placeholder="Exercise name" />
          <div class="exercise-actions">
            <button class="icon-circle red remove-exercise" type="button">−</button>
            <button class="icon-circle blue add-exercise" type="button">+</button>
          </div>
        </div>
        <div class="set-row">
          <span class="set-label">Set 1</span>
          <div class="set-fields">
            <div class="chip-field">
              <span class="chip-label">Weight</span>
              <input type="number" class="chip-input set-weight" placeholder="W" />
            </div>
            <div class="chip-field">
              <span class="chip-label">Reps</span>
              <input type="number" class="chip-input set-reps" placeholder="R" />
            </div>
            <div class="set-actions">
              <button class="icon-circle red small remove-set" type="button">−</button>
              <button class="icon-circle blue small add-set" type="button">+</button>
            </div>
          </div>
        </div>
      `;

      attachExerciseHandlers(card);
      return card;
    }

    function attachExerciseHandlers(card) {
      const removeExerciseBtn = card.querySelector(".remove-exercise");
      const addExerciseBtn = card.querySelector(".add-exercise");

      removeExerciseBtn.addEventListener("click", () => {
        const all = exerciseList.querySelectorAll(".exercise-card");
        if (all.length === 1) {
          // If it's the last one, just clear fields
          const nameInput = card.querySelector(".exercise-input");
          nameInput.value = "";
          const weights = card.querySelectorAll(".set-weight");
          const reps = card.querySelectorAll(".set-reps");
          weights.forEach((w) => (w.value = ""));
          reps.forEach((r) => (r.value = ""));
        } else {
          card.remove();
        }
      });

      addExerciseBtn.addEventListener("click", () => {
        const newCard = createExerciseCard();
        exerciseList.appendChild(newCard);
      });

      card.addEventListener("click", (e) => {
        if (e.target.closest(".add-set")) {
          addSet(card);
        } else if (e.target.closest(".remove-set")) {
          removeSet(card);
        }
      });
    }

    function addSet(card) {
      const setRows = card.querySelectorAll(".set-row");
      const newIndex = setRows.length + 1;

      const template = setRows[0];
      const clone = template.cloneNode(true);

      // reset inputs and label
      clone.querySelector(".set-label").textContent = "Set " + newIndex;
      clone.querySelector(".set-weight").value = "";
      clone.querySelector(".set-reps").value = "";

      card.appendChild(clone);
    }

    function removeSet(card) {
      const setRows = card.querySelectorAll(".set-row");
      if (setRows.length <= 1) {
        // always keep at least one set
        const first = setRows[0];
        first.querySelector(".set-weight").value = "";
        first.querySelector(".set-reps").value = "";
        return;
      }
      setRows[setRows.length - 1].remove();
    }

    // ===== ROUTINES (LOCAL STORAGE) =====
    const STORAGE_KEY = "code_and_iron_test_routines";
    const saveRoutineBtn = document.getElementById("saveRoutineBtn");
    const newRoutineNameInput = document.getElementById("newRoutineName");
    const savedRoutinesContainer = document.getElementById("savedRoutines");

    function getRoutines() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch {
        return [];
      }
    }

    function setRoutines(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    function serializeTodayLayout() {
      const exercises = [];
      const cards = exerciseList.querySelectorAll(".exercise-card");

      cards.forEach((card) => {
        const name = card.querySelector(".exercise-input").value || "";
        const sets = [];
        const setRows = card.querySelectorAll(".set-row");
        setRows.forEach((row) => {
          sets.push({
            weight: row.querySelector(".set-weight").value || "",
            reps: row.querySelector(".set-reps").value || "",
          });
        });
        exercises.push({ name, sets });
      });

      return { exercises };
    }

    function restoreTodayLayout(data) {
      exerciseList.innerHTML = "";
      (data.exercises || []).forEach((ex) => {
        const card = createExerciseCard();
        const nameInput = card.querySelector(".exercise-input");
        nameInput.value = ex.name || "";

        // remove default extra sets if any
        const existingSets = card.querySelectorAll(".set-row");
        existingSets.forEach((row, idx) => {
          if (idx > 0) row.remove();
        });

        (ex.sets || [{ weight: "", reps: "" }]).forEach((set, idx) => {
          if (idx === 0) {
            const row = card.querySelector(".set-row");
            row.querySelector(".set-weight").value = set.weight || "";
            row.querySelector(".set-reps").value = set.reps || "";
          } else {
            addSet(card);
            const rows = card.querySelectorAll(".set-row");
            const row = rows[rows.length - 1];
            row.querySelector(".set-weight").value = set.weight || "";
            row.querySelector(".set-reps").value = set.reps || "";
          }
        });

        exerciseList.appendChild(card);
      });

      if (!exerciseList.children.length) {
        exerciseList.appendChild(createExerciseCard());
      }
    }

    saveRoutineBtn.addEventListener("click", () => {
      const name = newRoutineNameInput.value.trim();
      if (!name) {
        alert("Give this routine a name first.");
        return;
      }

      const layout = serializeTodayLayout();
      const routines = getRoutines();
      const existing = routines.find((r) => r.name === name);

      if (existing) {
        existing.layout = layout;
      } else {
        routines.push({ id: Date.now(), name, layout });
      }

      setRoutines(routines);
      newRoutineNameInput.value = "";
      renderSavedRoutines();
    });

    function renderSavedRoutines() {
      const routines = getRoutines();
      savedRoutinesContainer.innerHTML = "";

      if (!routines.length) return;

      routines.forEach((r) => {
        const block = document.createElement("div");
        block.className = "routine-block";
        block.innerHTML = `
          <div class="routine-header-row">
            <div class="routine-name">${r.name}</div>
            <div class="routine-actions">
              <button class="pill-btn green" data-action="load">Load</button>
              <button class="pill-btn blue" data-action="close">Close</button>
              <button class="pill-btn red" data-action="delete">Delete</button>
            </div>
          </div>
        `;

        block.addEventListener("click", (e) => {
          const btn = e.target.closest("button");
          if (!btn) return;
          const action = btn.dataset.action;

          if (action === "load") {
            restoreTodayLayout(r.layout);
            showToday();
          } else if (action === "delete") {
            const remaining = getRoutines().filter(
              (x) => x.name !== r.name
            );
            setRoutines(remaining);
            renderSavedRoutines();
          } else if (action === "close") {
            // Just hide routines and go back
            showToday();
          }
        });

        savedRoutinesContainer.appendChild(block);
      });
    }

    // ===== INIT =====
    // Start with one exercise card
    exerciseList.appendChild(createExerciseCard());
  </script>
</body>
</html>