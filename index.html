<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Code and Iron Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-main: #000000;
      --bg-card: #111111;
      --bg-inner: #141414;
      --bg-input: #050505;
      --border-card: #222222;
      --accent-blue: #007aff;
      --accent-red: #d73a34;
      --accent-red-dark: #7a1714;
      --accent-green: #1fb655;
      --accent-text: #fbbf24;
      --text-primary: #ffffff;
      --text-muted: #a0a0a0;
      --radius-card: 24px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.7);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background: var(--bg-main);
      color: var(--text-primary);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
      -webkit-font-smoothing: antialiased;
      padding: 16px 16px 32px;
    }

    .app-shell {
      max-width: 480px;
      margin: 0 auto;
    }

    /* HEADER */

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .app-title {
      font-size: 30px;
      font-weight: 800;
      letter-spacing: 0.04em;
    }

    .menu-button {
      width: 52px;
      height: 52px;
      border-radius: 18px;
      border: none;
      background: #111111;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
      cursor: pointer;
    }

    .menu-lines {
      width: 22px;
      height: 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .menu-line {
      height: 3px;
      border-radius: 999px;
      background: #ffffff;
    }

    /* DROPDOWN */

    .menu-dropdown {
      position: absolute;
      right: 16px;
      top: 70px;
      background: #080808;
      border-radius: 22px;
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.8);
      padding: 8px 0;
      width: 210px;
      z-index: 20;
      display: none;
    }

    .menu-dropdown.open {
      display: block;
    }

    .menu-item {
      width: 100%;
      padding: 14px 20px;
      background: transparent;
      border: none;
      text-align: left;
      color: #ffffff;
      font-size: 17px;
      cursor: pointer;
    }

    .menu-item + .menu-item {
      border-top: 1px solid #1b1b1b;
    }

    .menu-item:active {
      background: #161616;
    }

    /* PAGES */

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* CARD / PANEL */

    .panel {
      background: var(--bg-card);
      border-radius: var(--radius-card);
      padding: 16px 16px 22px;
      border: 1px solid var(--border-card);
      box-shadow: var(--shadow-soft);
    }

    .panel-inner {
      background: var(--bg-inner);
      border-radius: 18px;
      padding: 14px 14px 18px;
      border: 1px solid #1f1f1f;
    }

    .section-title {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .section-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    /* INPUTS */

    .text-input {
      width: 100%;
      padding: 14px 14px;
      border-radius: 18px;
      border: 1px solid #222222;
      background: var(--bg-input);
      color: var(--text-primary);
      font-size: 15px;
    }

    .text-input::placeholder {
      color: #555555;
    }

    /* BUTTONS */

    .primary-btn {
      width: 100%;
      border-radius: var(--radius-pill);
      border: none;
      padding: 15px 18px;
      background: var(--accent-blue);
      color: #ffffff;
      font-size: 18px;
      font-weight: 700;
      text-align: center;
      margin-top: 16px;
      cursor: pointer;
    }

    .primary-btn:active {
      filter: brightness(0.9);
    }

    .pill-btn {
      padding: 8px 20px;
      border-radius: var(--radius-pill);
      border: none;
      font-size: 15px;
      font-weight: 600;
      color: #ffffff;
      cursor: pointer;
    }

    .pill-btn.green {
      background: var(--accent-green);
    }

    .pill-btn.blue {
      background: var(--accent-blue);
    }

    .pill-btn.red {
      background: var(--accent-red);
    }

    /* CIRCLE ICON BUTTONS */

    .circle-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 600;
      cursor: pointer;
    }

    .circle-btn.minus {
      background: var(--accent-red);
      color: #ffffff;
    }

    .circle-btn.plus {
      background: var(--accent-blue);
      color: #ffffff;
    }

    /* TODAY PAGE */

    .today-card {
      margin-top: 12px;
    }

    .today-title-row {
      margin-bottom: 8px;
      font-size: 20px;
      font-weight: 700;
    }

    .exercise {
      margin-top: 10px;
    }

    .exercise:first-child {
      margin-top: 2px;
    }

    .exercise-header-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .exercise-header-row .text-input {
      flex: 1;
    }

    .set-row {
      display: grid;
      grid-template-columns: auto 1fr 1fr;
      gap: 8px;
      align-items: center;
    }

    .set-label {
      font-size: 15px;
      font-weight: 700;
      color: var(--accent-text);
    }

    .set-input {
      width: 100%;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid #222222;
      background: var(--bg-input);
      color: var(--text-primary);
      font-size: 15px;
    }

    .set-input::placeholder {
      color: #555555;
    }

    /* ROUTINES PAGE */

    .saved-routines {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .routine-card {
      border-radius: 20px;
      border: 1px solid var(--border-card);
      background: var(--bg-inner);
      padding: 12px 12px 16px;
    }

    .routine-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .routine-name {
      font-size: 18px;
      font-weight: 600;
    }

    .routine-actions {
      display: flex;
      gap: 6px;
    }

    .routine-exercises {
      margin-top: 6px;
    }

    .routine-note {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 10px;
    }

    .back-link {
      margin-top: 18px;
      font-size: 16px;
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .back-link span {
      font-size: 18px;
    }

    /* SMALLER DEVICES */

    @media (max-width: 380px) {
      .app-title {
        font-size: 26px;
      }

      .section-title {
        font-size: 22px;
      }

      .exercise-header-row {
        gap: 6px;
      }

      .circle-btn {
        width: 36px;
        height: 36px;
        font-size: 22px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="app-title">Code and Iron Test</div>
      <button class="menu-button" id="menuToggle" aria-label="Menu">
        <div class="menu-lines">
          <div class="menu-line"></div>
          <div class="menu-line"></div>
          <div class="menu-line"></div>
        </div>
      </button>
    </header>

    <!-- Dropdown (only Routines now) -->
    <div class="menu-dropdown" id="menuDropdown">
      <button class="menu-item" data-target="routines">Routines</button>
    </div>

    <!-- TODAY PAGE -->
    <section class="page active" id="page-today">
      <div class="panel today-card">
        <div class="today-title-row">Today</div>
        <div class="panel-inner">
          <div id="todayExercises"></div>
        </div>
        <button class="primary-btn" id="addExerciseBtn">Add exercise</button>
      </div>
    </section>

    <!-- ROUTINES PAGE -->
    <section class="page" id="page-routines">
      <div class="panel">
        <div class="section-title">Routines</div>
        <div class="section-subtitle">
          Save exercise groups you can quickly load into Today.
        </div>

        <input
          id="newRoutineName"
          class="text-input"
          placeholder="e.g. Push Day, Legs, Back &amp; Biceps"
        />

        <button class="primary-btn" id="saveRoutineBtn">Save routine</button>

        <div class="saved-routines" id="savedRoutines"></div>

        <div class="back-link" id="backToToday">
          <span>&larr;</span> Back to logger
        </div>
      </div>
    </section>
  </div>

  <script>
    // --- SIMPLE STATE -------------------------------------------------------
    const todayKey = "ciTest_today";
    const routinesKey = "ciTest_routines";

    let todayExercises = [];
    let routines = [];

    function makeExercise() {
      return {
        id: crypto.randomUUID(),
        name: "",
        weight: "",
        reps: ""
      };
    }

    // --- STORAGE ------------------------------------------------------------
    function loadState() {
      try {
        const t = localStorage.getItem(todayKey);
        const r = localStorage.getItem(routinesKey);
        todayExercises = t ? JSON.parse(t) : [makeExercise()];
        routines = r ? JSON.parse(r) : [];
      } catch {
        todayExercises = [makeExercise()];
        routines = [];
      }
    }

    function saveToday() {
      localStorage.setItem(todayKey, JSON.stringify(todayExercises));
    }

    function saveRoutines() {
      localStorage.setItem(routinesKey, JSON.stringify(routines));
    }

    // --- RENDER TODAY -------------------------------------------------------
    const todayExercisesEl = document.getElementById("todayExercises");

    function renderToday() {
      todayExercisesEl.innerHTML = "";

      todayExercises.forEach((ex, index) => {
        const wrapper = document.createElement("div");
        wrapper.className = "exercise";
        wrapper.dataset.id = ex.id;

        // header row: exercise name + - +
        wrapper.innerHTML = `
          <div class="exercise-header-row">
            <input
              class="text-input"
              type="text"
              placeholder="Exercise name"
              value="${ex.name}"
              data-role="exercise-name"
            />
            <button class="circle-btn minus" data-role="remove-exercise" aria-label="Remove exercise">−</button>
            <button class="circle-btn plus" data-role="add-exercise-after" aria-label="Add exercise">+</button>
          </div>
          <div class="set-row">
            <div class="set-label">Set ${index + 1}</div>
            <input
              class="set-input"
              type="text"
              placeholder="Weight"
              value="${ex.weight}"
              data-role="weight"
            />
            <input
              class="set-input"
              type="text"
              placeholder="Reps"
              value="${ex.reps}"
              data-role="reps"
            />
          </div>
        `;

        todayExercisesEl.appendChild(wrapper);
      });
    }

    // --- RENDER ROUTINES ----------------------------------------------------
    const savedRoutinesEl = document.getElementById("savedRoutines");

    function renderRoutines() {
      savedRoutinesEl.innerHTML = "";

      if (!routines.length) {
        const empty = document.createElement("div");
        empty.className = "section-subtitle";
        empty.textContent = "No routines saved yet.";
        savedRoutinesEl.appendChild(empty);
        return;
      }

      routines.forEach((routine) => {
        const card = document.createElement("div");
        card.className = "routine-card";
        card.dataset.id = routine.id;

        const header = document.createElement("div");
        header.className = "routine-header";
        header.innerHTML = `
          <div class="routine-name">${routine.name}</div>
          <div class="routine-actions">
            <button class="pill-btn green" data-role="load-routine">Load</button>
            <button class="pill-btn blue" data-role="preview-routine">Close</button>
            <button class="pill-btn red" data-role="delete-routine">Delete</button>
          </div>
        `;
        card.appendChild(header);

        const exercisesWrap = document.createElement("div");
        exercisesWrap.className = "routine-exercises";

        routine.exercises.forEach((ex, index) => {
          const exDiv = document.createElement("div");
          exDiv.className = "exercise";

          exDiv.innerHTML = `
            <div class="exercise-header-row">
              <input
                class="text-input"
                type="text"
                value="${ex.name}"
                readonly
              />
              <button class="circle-btn minus" disabled>−</button>
              <button class="circle-btn plus" disabled>+</button>
            </div>
            <div class="set-row">
              <div class="set-label">Set ${index + 1}</div>
              <input
                class="set-input"
                type="text"
                value="${ex.weight}"
                readonly
              />
              <input
                class="set-input"
                type="text"
                value="${ex.reps}"
                readonly
              />
            </div>
          `;

          exercisesWrap.appendChild(exDiv);
        });

        if (!routine.exercises.length) {
          exercisesWrap.innerHTML =
            '<div class="section-subtitle">No exercises saved in this routine.</div>';
        }

        card.appendChild(exercisesWrap);

        const note = document.createElement("div");
        note.className = "routine-note";
        note.textContent =
          "You’re viewing this routine’s layout. Edits here are just for reference and won’t overwrite the saved routine.";
        card.appendChild(note);

        savedRoutinesEl.appendChild(card);
      });
    }

    // --- TODAY INTERACTION --------------------------------------------------
    todayExercisesEl.addEventListener("input", (e) => {
      const wrapper = e.target.closest(".exercise");
      if (!wrapper) return;
      const id = wrapper.dataset.id;
      const ex = todayExercises.find((x) => x.id === id);
      if (!ex) return;

      const role = e.target.dataset.role;
      if (role === "exercise-name") ex.name = e.target.value;
      if (role === "weight") ex.weight = e.target.value;
      if (role === "reps") ex.reps = e.target.value;

      saveToday();
    });

    todayExercisesEl.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const wrapper = btn.closest(".exercise");
      if (!wrapper) return;

      const id = wrapper.dataset.id;
      const index = todayExercises.findIndex((x) => x.id === id);
      if (index === -1) return;

      const role = btn.dataset.role;

      if (role === "remove-exercise") {
        if (todayExercises.length === 1) {
          // clear last one instead of deleting
          todayExercises[0].name = "";
          todayExercises[0].weight = "";
          todayExercises[0].reps = "";
        } else {
          todayExercises.splice(index, 1);
        }
        saveToday();
        renderToday();
      }

      if (role === "add-exercise-after") {
        const newEx = makeExercise();
        todayExercises.splice(index + 1, 0, newEx);
        saveToday();
        renderToday();
      }
    });

    document
      .getElementById("addExerciseBtn")
      .addEventListener("click", () => {
        todayExercises.push(makeExercise());
        saveToday();
        renderToday();
      });

    // --- ROUTINES EVENTS ----------------------------------------------------
    document
      .getElementById("saveRoutineBtn")
      .addEventListener("click", () => {
        const nameInput = document.getElementById("newRoutineName");
        const name = nameInput.value.trim();
        if (!name) {
          alert("Name your routine first.");
          return;
        }
        const payload = todayExercises.map((ex) => ({
          id: crypto.randomUUID(),
          name: ex.name,
          weight: ex.weight,
          reps: ex.reps
        }));

        routines.push({
          id: crypto.randomUUID(),
          name,
          exercises: payload
        });
        nameInput.value = "";
        saveRoutines();
        renderRoutines();
      });

    savedRoutinesEl.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const card = btn.closest(".routine-card");
      if (!card) return;
      const id = card.dataset.id;
      const routine = routines.find((r) => r.id === id);
      if (!routine) return;

      const role = btn.dataset.role;

      if (role === "delete-routine") {
        if (!confirm("Delete this routine?")) return;
        routines = routines.filter((r) => r.id !== id);
        saveRoutines();
        renderRoutines();
      }

      if (role === "load-routine") {
        todayExercises = routine.exercises.map((ex) => ({
          id: crypto.randomUUID(),
          name: ex.name,
          weight: ex.weight,
          reps: ex.reps
        }));
        saveToday();
        renderToday();
        showPage("today");
        closeMenu();
      }
    });

    // --- NAV / MENU ---------------------------------------------------------
    const menuToggle = document.getElementById("menuToggle");
    const menuDropdown = document.getElementById("menuDropdown");

    function closeMenu() {
      menuDropdown.classList.remove("open");
    }

    menuToggle.addEventListener("click", () => {
      menuDropdown.classList.toggle("open");
    });

    document.addEventListener("click", (e) => {
      if (
        !menuDropdown.contains(e.target) &&
        !menuToggle.contains(e.target)
      ) {
        closeMenu();
      }
    });

    function showPage(page) {
      document
        .querySelectorAll(".page")
        .forEach((p) => p.classList.remove("active"));
      if (page === "today") {
        document.getElementById("page-today").classList.add("active");
      } else {
        document.getElementById("page-routines").classList.add("active");
      }
    }

    menuDropdown.addEventListener("click", (e) => {
      const btn = e.target.closest(".menu-item");
      if (!btn) return;
      const target = btn.dataset.target;
      if (target === "routines") {
        showPage("routines");
        closeMenu();
      }
    });

    document
      .getElementById("backToToday")
      .addEventListener("click", () => showPage("today"));

    // --- INIT ---------------------------------------------------------------
    loadState();
    renderToday();
    renderRoutines();
  </script>
</body>
</html>