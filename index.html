<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Code and Iron Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Brand font (will use whatever matching file you have in /fonts) -->
  <style>
    @font-face {
      font-family: "CodeAndIron";
      src:
        url("fonts/CodeAndIron-Regular.woff2") format("woff2"),
        url("fonts/CodeAndIron-Regular.woff") format("woff"),
        url("fonts/CodeAndIron.woff2") format("woff2"),
        url("fonts/CodeAndIron.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }

    :root {
      --bg: #050505;
      --card: #111215;
      --card-soft: #17181b;
      --accent-blue: #0b82ff;
      --accent-red: #e43b33;
      --accent-green: #16a34a;
      --accent-text: #ffb020;
      --outline: rgba(255, 255, 255, 0.08);
      --text-main: #f9fafb;
      --text-subtle: #9ca3af;
      --radius-xl: 28px;
      --radius-lg: 22px;
      --radius-md: 16px;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.65);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top left, #16181d 0, #050506 42%, #000 80%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .app {
      max-width: 768px;
      margin: 0 auto;
      padding: 18px 16px 40px;
    }

    /* Top bar */

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .brand-title {
      font-family: "CodeAndIron", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 28px;
      letter-spacing: 0.04em;
      color: #fff;
    }

    @media (min-width: 420px) {
      .brand-title {
        font-size: 32px;
      }
    }

    .menu-toggle {
      width: 48px;
      height: 48px;
      border-radius: 18px;
      border: none;
      background: #111214;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      flex-direction: column;
      padding: 0;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
    }

    .menu-toggle span {
      width: 22px;
      height: 3px;
      border-radius: 999px;
      background: #ffffff;
    }

    .menu {
      position: absolute;
      right: 20px;
      top: 72px;
      background: #111214;
      border-radius: 18px;
      padding: 8px 0;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.9);
      display: none;
      z-index: 30;
      min-width: 170px;
    }

    .menu.open {
      display: block;
    }

    .menu button {
      width: 100%;
      padding: 10px 18px;
      background: transparent;
      border: none;
      color: #f9fafb;
      font-size: 16px;
      text-align: left;
      cursor: pointer;
    }

    .menu button:hover {
      background: #1f2933;
    }

    /* Sections */

    main {
      margin-top: 12px;
    }

    .section {
      display: none;
    }

    .section.section-active {
      display: block;
    }

    .card {
      background: radial-gradient(circle at top left, #1d1f26 0, #0e0f12 48%, #06070a 100%);
      border-radius: var(--radius-xl);
      padding: 18px 16px 22px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--outline);
    }

    .card-nested {
      background: #101114;
      border-radius: 24px;
      padding: 16px 14px 18px;
      border: 1px solid var(--outline);
    }

    .section-title {
      font-size: 26px;
      margin: 0 0 16px;
      font-weight: 700;
    }

    /* TODAY / EXERCISES */

    #todayExercises {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .exercise {
      border-radius: 24px;
      background: #111215;
      padding: 14px 14px 16px;
      border: 1px solid var(--outline);
    }

    .exercise-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .exercise-name {
      flex: 1 1 auto;
      min-width: 0;
    }

    .pill-input {
      width: 100%;
      padding: 11px 16px;
      border-radius: 999px;
      border: 1px solid var(--outline);
      background: #050608;
      color: var(--text-main);
      font-size: 16px;
    }

    .pill-input::placeholder {
      color: var(--text-subtle);
    }

    .circle-btn {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      line-height: 1;
      color: #ffffff;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
      flex: 0 0 auto;
    }

    .circle-btn--red {
      background: var(--accent-red);
    }

    .circle-btn--blue {
      background: var(--accent-blue);
    }

    .exercise-actions {
      display: flex;
      gap: 8px;
      flex: 0 0 auto;
    }

    /* Sets row */

    .sets {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .set-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .set-label {
      flex: 0 0 auto;
      min-width: 60px;
      font-weight: 700;
      color: var(--accent-text);
      font-size: 16px;
    }

    .set-inputs {
      flex: 1 1 auto;
      min-width: 0;
      display: flex;
      gap: 8px;
    }

    .set-inputs .pill-input {
      border-radius: 18px;
      padding: 9px 14px;
      font-size: 15px;
    }

    .set-actions {
      display: flex;
      flex: 0 0 auto;
      gap: 8px;
    }

    .circle-btn--small {
      width: 42px;
      height: 42px;
      font-size: 22px;
    }

    /* ROUTINES */

    #routinesSection .card {
      padding-bottom: 24px;
    }

    .helper-text {
      margin: 10px 2px 16px;
      font-size: 15px;
      color: var(--text-subtle);
    }

    .primary-btn {
      display: block;
      width: 100%;
      margin-top: 6px;
      border-radius: 999px;
      border: none;
      background: var(--accent-blue);
      color: #fff;
      font-size: 17px;
      font-weight: 600;
      padding: 13px 18px;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
    }

    .primary-btn:active {
      transform: translateY(1px);
    }

    .routines-list {
      margin-top: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .routine-card {
      background: #101114;
      border-radius: 22px;
      padding: 12px 14px 12px;
      border: 1px solid var(--outline);
    }

    .routine-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 4px;
    }

    .routine-name {
      font-size: 18px;
      font-weight: 700;
    }

    .routine-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .chip-btn {
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      color: #fff;
    }

    .chip-btn--green {
      background: var(--accent-green);
    }

    .chip-btn--blue {
      background: var(--accent-blue);
    }

    .chip-btn--red {
      background: var(--accent-red);
    }

    .routine-meta {
      font-size: 13px;
      color: var(--text-subtle);
      margin-top: 2px;
    }

    .back-link {
      margin-top: 18px;
      font-size: 16px;
      color: var(--text-main);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .back-link span {
      font-size: 19px;
    }

    /* Utility */

    input:focus,
    button:focus {
      outline: 2px solid var(--accent-blue);
      outline-offset: 2px;
    }

    @media (min-width: 600px) {
      .card {
        padding: 20px 20px 24px;
      }

      .card-nested {
        padding: 18px 16px 20px;
      }

      .exercise-header {
        gap: 14px;
      }

      .set-row {
        gap: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="top-bar">
      <div class="brand-title">Code and Iron Test</div>

      <button class="menu-toggle" id="menuToggle" aria-label="Open navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <nav class="menu" id="menu">
        <button type="button" data-target="todaySection">Today</button>
        <button type="button" data-target="routinesSection">Routines</button>
      </nav>
    </header>

    <main>
      <!-- TODAY -------------------------------------------------------------->
      <section id="todaySection" class="section section-active">
        <div class="card">
          <h2 class="section-title">Today</h2>

          <div id="todayExercises" class="card-nested">
            <!-- Exercises rendered here -->
          </div>
        </div>
      </section>

      <!-- ROUTINES ----------------------------------------------------------->
      <section id="routinesSection" class="section">
        <div class="card">
          <h2 class="section-title">Routines</h2>
          <p class="helper-text">
            Save exercise groups you can quickly load into <strong>Today</strong>.
          </p>

          <input
            id="routineNameInput"
            class="pill-input"
            type="text"
            placeholder="e.g. Push Day, Legs, Back &amp; Biceps"
            autocomplete="off"
          />

          <button id="saveRoutineBtn" class="primary-btn" type="button">
            Save routine
          </button>

          <div id="routinesList" class="routines-list">
            <!-- Saved routines -->
          </div>

          <a href="#todaySection" class="back-link" id="backToToday">
            <span>←</span>
            <span>Back to logger</span>
          </a>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ---------- State ----------
    const STORAGE_KEY = "ci_test_state_v1";

    let appState = {
      today: [],
      routines: []
    };

    // ---------- DOM refs ----------
    const menuToggle = document.getElementById("menuToggle");
    const menu = document.getElementById("menu");
    const todaySection = document.getElementById("todaySection");
    const routinesSection = document.getElementById("routinesSection");

    const todayExercisesEl = document.getElementById("todayExercises");
    const routineNameInput = document.getElementById("routineNameInput");
    const saveRoutineBtn = document.getElementById("saveRoutineBtn");
    const routinesListEl = document.getElementById("routinesList");
    const backToToday = document.getElementById("backToToday");

    // ---------- Helpers ----------
    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
      } catch (err) {
        console.warn("Unable to save state", err);
      }
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (parsed && typeof parsed === "object") {
            if (Array.isArray(parsed.today)) appState.today = parsed.today;
            if (Array.isArray(parsed.routines)) appState.routines = parsed.routines;
          }
        }
      } catch (err) {
        console.warn("Unable to load state", err);
      }

      // If no exercises, start with one blank exercise & set
      if (!appState.today.length) {
        appState.today.push({
          name: "",
          sets: [{ weight: "", reps: "" }]
        });
      }
    }

    function countSets(exercises) {
      return exercises.reduce((total, ex) => total + ex.sets.length, 0);
    }

    // ---------- Render TODAY ----------
    function renderToday() {
      todayExercisesEl.innerHTML = "";

      appState.today.forEach((exercise, exerciseIndex) => {
        const exEl = document.createElement("div");
        exEl.className = "exercise";
        exEl.dataset.exerciseIndex = exerciseIndex;

        exEl.innerHTML = `
          <div class="exercise-header">
            <div class="exercise-name">
              <input
                type="text"
                class="pill-input exercise-name-input"
                placeholder="Exercise name"
                value="${exercise.name || ""}"
              />
            </div>
            <div class="exercise-actions">
              <button type="button" class="circle-btn circle-btn--red remove-exercise" aria-label="Remove exercise">−</button>
              <button type="button" class="circle-btn circle-btn--blue add-exercise" aria-label="Add exercise">+</button>
            </div>
          </div>
          <div class="sets"></div>
        `;

        const setsContainer = exEl.querySelector(".sets");

        exercise.sets.forEach((set, setIndex) => {
          const setRow = document.createElement("div");
          setRow.className = "set-row";
          setRow.dataset.setIndex = setIndex;

          setRow.innerHTML = `
            <div class="set-label">Set <span class="set-number">${setIndex + 1}</span></div>
            <div class="set-inputs">
              <input
                type="number"
                inputmode="decimal"
                class="pill-input set-weight-input"
                placeholder="Weight"
                value="${set.weight ?? ""}"
              />
              <input
                type="number"
                inputmode="numeric"
                class="pill-input set-reps-input"
                placeholder="Reps"
                value="${set.reps ?? ""}"
              />
            </div>
            <div class="set-actions">
              <button type="button" class="circle-btn circle-btn--red circle-btn--small remove-set" aria-label="Remove set">−</button>
              <button type="button" class="circle-btn circle-btn--blue circle-btn--small add-set" aria-label="Add set">+</button>
            </div>
          `;

          setsContainer.appendChild(setRow);
        });

        todayExercisesEl.appendChild(exEl);
      });
    }

    function syncTodayFromDOM() {
      const exercises = [];
      todayExercisesEl.querySelectorAll(".exercise").forEach(exEl => {
        const exName = exEl.querySelector(".exercise-name-input").value.trim();
        const sets = [];
        exEl.querySelectorAll(".set-row").forEach(row => {
          const weight = row.querySelector(".set-weight-input").value.trim();
          const reps = row.querySelector(".set-reps-input").value.trim();
          sets.push({ weight, reps });
        });

        exercises.push({ name: exName, sets });
      });

      appState.today = exercises;
      saveState();
    }

    function addExercise(afterIndex = null) {
      const newExercise = {
        name: "",
        sets: [{ weight: "", reps: "" }]
      };

      if (afterIndex === null || afterIndex >= appState.today.length - 1) {
        appState.today.push(newExercise);
      } else {
        appState.today.splice(afterIndex + 1, 0, newExercise);
      }

      saveState();
      renderToday();
    }

    function removeExercise(index) {
      if (appState.today.length === 1) {
        // Reset the only exercise instead of deleting
        appState.today[0] = { name: "", sets: [{ weight: "", reps: "" }] };
      } else {
        appState.today.splice(index, 1);
      }
      saveState();
      renderToday();
    }

    function addSet(exerciseIndex, afterIndex) {
      const sets = appState.today[exerciseIndex].sets;
      const newSet = { weight: "", reps: "" };

      if (afterIndex === null || afterIndex >= sets.length - 1) {
        sets.push(newSet);
      } else {
        sets.splice(afterIndex + 1, 0, newSet);
      }

      saveState();
      renderToday();
    }

    function removeSet(exerciseIndex, setIndex) {
      const sets = appState.today[exerciseIndex].sets;
      if (sets.length === 1) {
        sets[0] = { weight: "", reps: "" };
      } else {
        sets.splice(setIndex, 1);
      }
      saveState();
      renderToday();
    }

    // ---------- Render ROUTINES ----------
    function renderRoutines() {
      routinesListEl.innerHTML = "";

      if (!appState.routines.length) {
        const empty = document.createElement("div");
        empty.style.color = "var(--text-subtle)";
        empty.style.fontSize = "14px";
        empty.textContent = "No routines saved yet. Build a day in Today, give it a name, and tap “Save routine.”";
        routinesListEl.appendChild(empty);
        return;
      }

      appState.routines.forEach((routine, index) => {
        const card = document.createElement("div");
        card.className = "routine-card";
        card.dataset.routineIndex = index;

        const exerciseCount = routine.exercises.length;
        const setCount = countSets(routine.exercises);

        card.innerHTML = `
          <div class="routine-header">
            <div class="routine-name">${routine.name || "Unnamed routine"}</div>
            <div class="routine-actions">
              <button type="button" class="chip-btn chip-btn--green load-routine">Load</button>
              <button type="button" class="chip-btn chip-btn--red delete-routine">Delete</button>
            </div>
          </div>
          <div class="routine-meta">${exerciseCount} exercise${exerciseCount !== 1 ? "s" : ""} · ${setCount} set${setCount !== 1 ? "s" : ""}</div>
        `;

        routinesListEl.appendChild(card);
      });
    }

    function saveRoutine() {
      const name = routineNameInput.value.trim();
      if (!name) {
        routineNameInput.focus();
        return;
      }

      syncTodayFromDOM();

      appState.routines.push({
        name,
        exercises: JSON.parse(JSON.stringify(appState.today))
      });

      routineNameInput.value = "";
      saveState();
      renderRoutines();
    }

    function loadRoutine(index) {
      const routine = appState.routines[index];
      if (!routine) return;
      appState.today = JSON.parse(JSON.stringify(routine.exercises));
      saveState();
      renderToday();
      // Jump back to Today view
      showSection("todaySection");
    }

    function deleteRoutine(index) {
      appState.routines.splice(index, 1);
      saveState();
      renderRoutines();
    }

    // ---------- Navigation ----------
    function showSection(id) {
      if (id === "todaySection") {
        todaySection.classList.add("section-active");
        routinesSection.classList.remove("section-active");
      } else {
        routinesSection.classList.add("section-active");
        todaySection.classList.remove("section-active");
      }
      menu.classList.remove("open");
    }

    // ---------- Event wiring ----------
    menuToggle.addEventListener("click", () => {
      menu.classList.toggle("open");
    });

    menu.addEventListener("click", e => {
      const btn = e.target.closest("button[data-target]");
      if (!btn) return;
      showSection(btn.dataset.target);
    });

    backToToday.addEventListener("click", e => {
      e.preventDefault();
      showSection("todaySection");
    });

    // Today interactions (event delegation)
    todayExercisesEl.addEventListener("click", e => {
      const exEl = e.target.closest(".exercise");
      if (!exEl) return;
      const exerciseIndex = Number(exEl.dataset.exerciseIndex);

      if (e.target.closest(".add-exercise")) {
        addExercise(exerciseIndex);
      } else if (e.target.closest(".remove-exercise")) {
        removeExercise(exerciseIndex);
      } else if (e.target.closest(".add-set")) {
        const row = e.target.closest(".set-row");
        const setIndex = Number(row.dataset.setIndex);
        addSet(exerciseIndex, setIndex);
      } else if (e.target.closest(".remove-set")) {
        const row = e.target.closest(".set-row");
        const setIndex = Number(row.dataset.setIndex);
        removeSet(exerciseIndex, setIndex);
      }
    });

    // Save on typing in any today input
    todayExercisesEl.addEventListener("input", () => {
      syncTodayFromDOM();
    });

    saveRoutineBtn.addEventListener("click", saveRoutine);

    routinesListEl.addEventListener("click", e => {
      const card = e.target.closest(".routine-card");
      if (!card) return;
      const index = Number(card.dataset.routineIndex);

      if (e.target.closest(".load-routine")) {
        loadRoutine(index);
      } else if (e.target.closest(".delete-routine")) {
        deleteRoutine(index);
      }
    });

    // ---------- Init ----------
    loadState();
    renderToday();
    renderRoutines();
  </script>
</body>
</html>