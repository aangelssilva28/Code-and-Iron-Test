<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Code and Iron Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Germania One font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Germania+One&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #000000;
      --card: #101010;
      --card-inner: #171717;
      --border: #2b2b2b;
      --accent-blue: #0b84ff;
      --accent-red: #e23b3b;
      --accent-green: #23b25b;
      --accent-gold: #ffb43b;
      --text-main: #ffffff;
      --text-muted: #b0b0b0;
      --input-bg: #050505;
      --input-border: #2e2e2e;
      --shadow-soft: 0 16px 40px rgba(0, 0, 0, 0.55);
      --radius-lg: 26px;
      --radius-md: 18px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: "Germania One", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #181818 0, #000 55%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .app-shell {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 20px 18px 40px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 10px;
    }

    .brand-title {
      font-size: 32px;
      letter-spacing: 0.03em;
      text-shadow: 0 0 18px rgba(0, 0, 0, 0.9);
    }

    .menu-button {
      width: 48px;
      height: 48px;
      border-radius: 18px;
      border: 1px solid #333;
      background: linear-gradient(145deg, #171717, #101010);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-soft);
      cursor: pointer;
    }

    .menu-icon {
      width: 22px;
      height: 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .menu-icon span {
      display: block;
      height: 3px;
      border-radius: 999px;
      background: #f5f5f5;
    }

    .dropdown-menu {
      position: absolute;
      top: 80px;
      right: 24px;
      width: 210px;
      border-radius: 24px;
      padding: 10px 0;
      background: rgba(10, 10, 10, 0.97);
      border: 1px solid #333;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(16px);
      display: none;
      z-index: 20;
    }

    .dropdown-menu.open {
      display: block;
    }

    .dropdown-item {
      padding: 12px 20px;
      font-size: 18px;
      color: var(--text-main);
      cursor: pointer;
    }

    .dropdown-item:hover {
      background: #1b1b1b;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .panel {
      background: radial-gradient(circle at top left, #191919 0, #080808 55%);
      border-radius: 34px;
      padding: 22px 18px 24px;
      border: 1px solid #252525;
      box-shadow: var(--shadow-soft);
    }

    .panel-inner {
      background: #111111;
      border-radius: 28px;
      padding: 16px 14px 18px;
      border: 1px solid #222222;
    }

    .panel-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .panel-title {
      font-size: 32px;
    }

    .muted {
      color: var(--text-muted);
      font-size: 16px;
      margin-top: 4px;
    }

    .field-label {
      font-size: 17px;
      margin-bottom: 6px;
    }

    .input-shell {
      width: 100%;
      border-radius: 999px;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      padding: 0 18px;
      height: 54px;
      display: flex;
      align-items: center;
    }

    .input-shell input {
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-main);
      font-size: 18px;
      width: 100%;
    }

    .input-shell input::placeholder {
      color: #666;
    }

    .exercise-card {
      margin-top: 18px;
      padding: 16px 14px 14px;
      border-radius: 26px;
      background: #141414;
      border: 1px solid #262626;
    }

    .exercise-header-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .exercise-header-row .input-shell {
      flex: 1;
      height: 50px;
    }

    .exercise-actions {
      display: flex;
      gap: 8px;
    }

    .round-btn {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      border: none;
      color: #fff;
      font-size: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
    }

    .round-btn.red {
      background: var(--accent-red);
    }

    .round-btn.blue {
      background: var(--accent-blue);
    }

    .round-btn:active {
      transform: scale(0.96);
    }

    .set-row {
      display: grid;
      grid-template-columns: auto 1.1fr 1.1fr auto auto;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }

    .set-label {
      color: var(--accent-gold);
      font-size: 20px;
      padding-left: 4px;
    }

    .set-group-label {
      font-size: 15px;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    .compact-input-shell {
      border-radius: 18px;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      padding: 0 12px;
      height: 48px;
      display: flex;
      align-items: center;
    }

    .compact-input-shell input {
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-main);
      width: 100%;
      font-size: 16px;
      text-align: left;
    }

    .compact-input-shell input::placeholder {
      color: #666;
    }

    .set-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .round-btn.small {
      width: 44px;
      height: 44px;
      font-size: 24px;
    }

    .section-spacer {
      height: 24px;
    }

    /* Routines */
    #routines-view {
      display: none;
      flex-direction: column;
      gap: 18px;
    }

    .cta-btn {
      margin-top: 14px;
      width: 100%;
      height: 60px;
      border-radius: var(--radius-pill);
      border: none;
      cursor: pointer;
      font-size: 20px;
      letter-spacing: 0.02em;
      color: #fff;
      background: var(--accent-blue);
      box-shadow: var(--shadow-soft);
    }

    .cta-btn:active {
      transform: scale(0.97);
    }

    .routines-list {
      margin-top: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .routine-card {
      background: #141414;
      border-radius: 26px;
      border: 1px solid #262626;
      padding: 14px 14px 16px;
    }

    .routine-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .routine-name {
      font-size: 24px;
    }

    .routine-buttons {
      display: flex;
      gap: 8px;
    }

    .pill-btn {
      border-radius: var(--radius-pill);
      border: none;
      padding: 8px 16px;
      font-size: 16px;
      color: #fff;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
      white-space: nowrap;
    }

    .pill-btn.green {
      background: var(--accent-green);
    }

    .pill-btn.blue {
      background: var(--accent-blue);
    }

    .pill-btn.red {
      background: var(--accent-red);
    }

    .back-link {
      margin-top: 18px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-main);
      font-size: 18px;
      cursor: pointer;
    }

    .back-link span {
      font-size: 22px;
    }

    @media (max-width: 400px) {
      .brand-title {
        font-size: 26px;
      }
      .panel-title {
        font-size: 28px;
      }
      .set-row {
        grid-template-columns: auto 1fr 1fr auto auto;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="brand-title">Code and Iron Test</div>
      <button class="menu-button" id="menu-toggle" aria-label="Menu">
        <div class="menu-icon">
          <span></span><span></span><span></span>
        </div>
      </button>

      <div class="dropdown-menu" id="dropdown-menu">
        <div class="dropdown-item" data-nav="routines">Routines</div>
      </div>
    </header>

    <main>
      <!-- TODAY / LOGGER VIEW -->
      <section id="today-view">
        <div class="panel">
          <div class="panel-header-row">
            <div>
              <div class="panel-title">Today</div>
            </div>
          </div>

          <div class="panel-inner">
            <div id="today-exercises-container">
              <!-- exercises injected by JS -->
            </div>
          </div>
        </div>
      </section>

      <!-- ROUTINES VIEW -->
      <section id="routines-view">
        <div class="panel">
          <div class="panel-header-row">
            <div>
              <div class="panel-title">Routines</div>
              <div class="muted">Save exercise groups you can quickly load into Today.</div>
            </div>
          </div>

          <div class="panel-inner">
            <div class="field-label">New routine name</div>
            <div class="input-shell" style="margin-bottom: 10px;">
              <input id="routine-name-input" type="text" placeholder="e.g. Push Day, Legs, Back &amp; Biceps">
            </div>

            <button class="cta-btn" id="save-routine-btn">Save routine</button>

            <div class="routines-list" id="routines-list">
              <!-- routine cards injected by JS -->
            </div>

            <div class="section-spacer"></div>

            <div class="back-link" id="back-to-logger">
              <span>←</span>
              <span>Back to logger</span>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ----- DATA MODEL HELPERS -----
    function newId() {
      return Math.random().toString(36).slice(2) + Date.now().toString(36);
    }

    function createEmptySet() {
      return {
        id: newId(),
        weight: "",
        reps: ""
      };
    }

    function createEmptyExercise() {
      return {
        id: newId(),
        name: "",
        sets: [createEmptySet()]
      };
    }

    function deepClone(obj) {
      return JSON.parse(JSON.stringify(obj));
    }

    // ----- STATE -----
    const TODAY_KEY = "ci_test_today_exercises";
    const ROUTINES_KEY = "ci_test_routines";

    let todayExercises = [];
    let routines = [];

    function loadState() {
      try {
        const t = localStorage.getItem(TODAY_KEY);
        todayExercises = t ? JSON.parse(t) : [createEmptyExercise()];
      } catch {
        todayExercises = [createEmptyExercise()];
      }

      try {
        const r = localStorage.getItem(ROUTINES_KEY);
        routines = r ? JSON.parse(r) : [];
      } catch {
        routines = [];
      }
    }

    function saveToday() {
      localStorage.setItem(TODAY_KEY, JSON.stringify(todayExercises));
    }

    function saveRoutines() {
      localStorage.setItem(ROUTINES_KEY, JSON.stringify(routines));
    }

    // ----- RENDERING -----
    const todayContainer = document.getElementById("today-exercises-container");
    const routinesListEl = document.getElementById("routines-list");

    function renderToday() {
      if (!todayExercises.length) {
        todayExercises.push(createEmptyExercise());
      }

      todayContainer.innerHTML = todayExercises.map((ex, exIndex) => {
        const setsHtml = ex.sets.map((set, setIndex) => {
          const setNumber = setIndex + 1;
          return `
            <div class="set-row" data-context="today" data-exercise-id="${ex.id}" data-set-index="${setIndex}">
              <div class="set-label">Set ${setNumber}</div>

              <div>
                <div class="set-group-label">Weight</div>
                <div class="compact-input-shell">
                  <input
                    type="text"
                    class="weight-input"
                    data-context="today"
                    data-exercise-id="${ex.id}"
                    data-set-index="${setIndex}"
                    placeholder="Weight"
                    value="${set.weight || ""}"
                  >
                </div>
              </div>

              <div>
                <div class="set-group-label">Reps</div>
                <div class="compact-input-shell">
                  <input
                    type="text"
                    class="reps-input"
                    data-context="today"
                    data-exercise-id="${ex.id}"
                    data-set-index="${setIndex}"
                    placeholder="Reps"
                    value="${set.reps || ""}"
                  >
                </div>
              </div>

              <div class="set-actions">
                <button
                  class="round-btn small red"
                  data-role="remove-set"
                  data-context="today"
                  data-exercise-id="${ex.id}"
                  data-set-index="${setIndex}"
                >−</button>
                <button
                  class="round-btn small blue"
                  data-role="add-set"
                  data-context="today"
                  data-exercise-id="${ex.id}"
                >+</button>
              </div>
            </div>
          `;
        }).join("");

        return `
          <div class="exercise-card" data-context="today" data-exercise-id="${ex.id}">
            <div class="exercise-header-row">
              <div class="input-shell">
                <input
                  type="text"
                  class="exercise-name-input"
                  data-context="today"
                  data-exercise-id="${ex.id}"
                  placeholder="Exercise name"
                  value="${ex.name || ""}"
                >
              </div>
              <div class="exercise-actions">
                <button
                  class="round-btn red"
                  data-role="remove-exercise"
                  data-context="today"
                  data-exercise-id="${ex.id}"
                >−</button>
                <button
                  class="round-btn blue"
                  data-role="add-exercise"
                  data-context="today"
                  data-after-id="${ex.id}"
                >+</button>
              </div>
            </div>

            ${setsHtml}
          </div>
        `;
      }).join("");
    }

    function renderRoutineCardExercises(exercises, routineId) {
      return exercises.map((ex) => {
        const setsHtml = ex.sets.map((set, setIndex) => {
          const setNumber = setIndex + 1;
          return `
            <div class="set-row" data-context="routine" data-routine-id="${routineId}" data-exercise-id="${ex.id}" data-set-index="${setIndex}">
              <div class="set-label">Set ${setNumber}</div>

              <div>
                <div class="set-group-label">Weight</div>
                <div class="compact-input-shell">
                  <input
                    type="text"
                    class="weight-input"
                    data-context="routine"
                    data-routine-id="${routineId}"
                    data-exercise-id="${ex.id}"
                    data-set-index="${setIndex}"
                    placeholder="Weight"
                    value="${set.weight || ""}"
                  >
                </div>
              </div>

              <div>
                <div class="set-group-label">Reps</div>
                <div class="compact-input-shell">
                  <input
                    type="text"
                    class="reps-input"
                    data-context="routine"
                    data-routine-id="${routineId}"
                    data-exercise-id="${ex.id}"
                    data-set-index="${setIndex}"
                    placeholder="Reps"
                    value="${set.reps || ""}"
                  >
                </div>
              </div>

              <div class="set-actions">
                <button
                  class="round-btn small red"
                  data-role="remove-set"
                  data-context="routine"
                  data-routine-id="${routineId}"
                  data-exercise-id="${ex.id}"
                  data-set-index="${setIndex}"
                >−</button>
                <button
                  class="round-btn small blue"
                  data-role="add-set"
                  data-context="routine"
                  data-routine-id="${routineId}"
                  data-exercise-id="${ex.id}"
                >+</button>
              </div>
            </div>
          `;
        }).join("");

        return `
          <div class="exercise-card" data-context="routine" data-routine-id="${routineId}" data-exercise-id="${ex.id}">
            <div class="exercise-header-row">
              <div class="input-shell">
                <input
                  type="text"
                  class="exercise-name-input"
                  data-context="routine"
                  data-routine-id="${routineId}"
                  data-exercise-id="${ex.id}"
                  placeholder="Exercise name"
                  value="${ex.name || ""}"
                >
              </div>
              <div class="exercise-actions">
                <button
                  class="round-btn red"
                  data-role="remove-exercise"
                  data-context="routine"
                  data-routine-id="${routineId}"
                  data-exercise-id="${ex.id}"
                >−</button>
                <button
                  class="round-btn blue"
                  data-role="add-exercise"
                  data-context="routine"
                  data-routine-id="${routineId}"
                  data-after-id="${ex.id}"
                >+</button>
              </div>
            </div>

            ${setsHtml}
          </div>
        `;
      }).join("");
    }

    function renderRoutines() {
      if (!routines.length) {
        routinesListEl.innerHTML = "";
        return;
      }

      routinesListEl.innerHTML = routines.map(routine => {
        const exercisesHtml = renderRoutineCardExercises(routine.exercises, routine.id);
        return `
          <div class="routine-card" data-routine-id="${routine.id}">
            <div class="routine-header">
              <div class="routine-name">${routine.name}</div>
              <div class="routine-buttons">
                <button class="pill-btn green" data-role="load-routine" data-routine-id="${routine.id}">Load</button>
                <button class="pill-btn blue" data-role="close-routine" data-routine-id="${routine.id}">Close</button>
                <button class="pill-btn red" data-role="delete-routine" data-routine-id="${routine.id}">Delete</button>
              </div>
            </div>

            <div class="panel-inner">
              ${exercisesHtml}
            </div>
          </div>
        `;
      }).join("");
    }

    // ----- EVENT HANDLERS -----
    document.addEventListener("click", (e) => {
      const role = e.target.getAttribute("data-role");
      const context = e.target.getAttribute("data-context");

      // Menu
      if (e.target.id === "menu-toggle" || e.target.closest("#menu-toggle")) {
        document.getElementById("dropdown-menu").classList.toggle("open");
        return;
      }

      if (e.target.closest("#dropdown-menu")) {
        const nav = e.target.getAttribute("data-nav");
        if (nav === "routines") {
          showRoutinesView();
        }
        document.getElementById("dropdown-menu").classList.remove("open");
        return;
      }

      // Save routine
      if (e.target.id === "save-routine-btn") {
        const nameInput = document.getElementById("routine-name-input");
        const name = nameInput.value.trim();
        if (!name) return;
        const newRoutine = {
          id: newId(),
          name,
          exercises: deepClone(todayExercises)
        };
        routines.push(newRoutine);
        saveRoutines();
        renderRoutines();
        nameInput.value = "";
        return;
      }

      // Back to logger
      if (e.target.id === "back-to-logger" || e.target.closest("#back-to-logger")) {
        showTodayView();
        return;
      }

      // Routine buttons (load, delete, close)
      if (role === "load-routine") {
        const routineId = e.target.getAttribute("data-routine-id");
        const routine = routines.find(r => r.id === routineId);
        if (routine) {
          todayExercises = deepClone(routine.exercises);
          saveToday();
          renderToday();
          showTodayView();
        }
        return;
      }

      if (role === "delete-routine") {
        const routineId = e.target.getAttribute("data-routine-id");
        routines = routines.filter(r => r.id !== routineId);
        saveRoutines();
        renderRoutines();
        return;
      }

      if (role === "close-routine") {
        const routineId = e.target.getAttribute("data-routine-id");
        const card = document.querySelector(`.routine-card[data-routine-id="${routineId}"] .panel-inner`);
        if (card) {
          card.style.display = card.style.display === "none" ? "block" : "none";
        }
        return;
      }

      // Exercise / set buttons (today or routine)
      if (!role || !context) return;

      if (role === "add-exercise") {
        const afterId = e.target.getAttribute("data-after-id");
        if (context === "today") {
          const idx = todayExercises.findIndex(ex => ex.id === afterId);
          const insertAt = idx === -1 ? todayExercises.length : idx + 1;
          todayExercises.splice(insertAt, 0, createEmptyExercise());
          saveToday();
          renderToday();
        } else if (context === "routine") {
          const routineId = e.target.getAttribute("data-routine-id");
          const routine = routines.find(r => r.id === routineId);
          if (!routine) return;
          const idx = routine.exercises.findIndex(ex => ex.id === afterId);
          const insertAt = idx === -1 ? routine.exercises.length : idx + 1;
          routine.exercises.splice(insertAt, 0, createEmptyExercise());
          saveRoutines();
          renderRoutines();
        }
        return;
      }

      if (role === "remove-exercise") {
        const exerciseId = e.target.getAttribute("data-exercise-id");
        if (context === "today") {
          if (todayExercises.length === 1) {
            todayExercises[0] = createEmptyExercise();
          } else {
            todayExercises = todayExercises.filter(ex => ex.id !== exerciseId);
          }
          saveToday();
          renderToday();
        } else if (context === "routine") {
          const routineId = e.target.getAttribute("data-routine-id");
          const routine = routines.find(r => r.id === routineId);
          if (!routine) return;
          if (routine.exercises.length === 1) {
            routine.exercises[0] = createEmptyExercise();
          } else {
            routine.exercises = routine.exercises.filter(ex => ex.id !== exerciseId);
          }
          saveRoutines();
          renderRoutines();
        }
        return;
      }

      if (role === "add-set") {
        const exerciseId = e.target.getAttribute("data-exercise-id");
        if (context === "today") {
          const exercise = todayExercises.find(ex => ex.id === exerciseId);
          if (!exercise) return;
          exercise.sets.push(createEmptySet());
          saveToday();
          renderToday();
        } else if (context === "routine") {
          const routineId = e.target.getAttribute("data-routine-id");
          const routine = routines.find(r => r.id === routineId);
          if (!routine) return;
          const exercise = routine.exercises.find(ex => ex.id === exerciseId);
          if (!exercise) return;
          exercise.sets.push(createEmptySet());
          saveRoutines();
          renderRoutines();
        }
        return;
      }

      if (role === "remove-set") {
        const exerciseId = e.target.getAttribute("data-exercise-id");
        const setIndex = parseInt(e.target.getAttribute("data-set-index"), 10);
        if (isNaN(setIndex)) return;

        if (context === "today") {
          const exercise = todayExercises.find(ex => ex.id === exerciseId);
          if (!exercise) return;
          if (exercise.sets.length === 1) {
            exercise.sets[0] = createEmptySet();
          } else {
            exercise.sets.splice(setIndex, 1);
          }
          saveToday();
          renderToday();
        } else if (context === "routine") {
          const routineId = e.target.getAttribute("data-routine-id");
          const routine = routines.find(r => r.id === routineId);
          if (!routine) return;
          const exercise = routine.exercises.find(ex => ex.id === exerciseId);
          if (!exercise) return;
          if (exercise.sets.length === 1) {
            exercise.sets[0] = createEmptySet();
          } else {
            exercise.sets.splice(setIndex, 1);
          }
          saveRoutines();
          renderRoutines();
        }
        return;
      }
    });

    // Input updates
    document.addEventListener("input", (e) => {
      const cls = e.target.classList;
      const context = e.target.getAttribute("data-context");
      if (!context) return;

      if (cls.contains("exercise-name-input")) {
        const exId = e.target.getAttribute("data-exercise-id");
        const val = e.target.value;
        if (context === "today") {
          const ex = todayExercises.find(ex => ex.id === exId);
          if (ex) {
            ex.name = val;
            saveToday();
          }
        } else if (context === "routine") {
          const routineId = e.target.getAttribute("data-routine-id");
          const routine = routines.find(r => r.id === routineId);
          if (!routine) return;
          const ex = routine.exercises.find(ex => ex.id === exId);
          if (ex) {
            ex.name = val;
            saveRoutines();
          }
        }
        return;
      }

      if (cls.contains("weight-input") || cls.contains("reps-input")) {
        const exId = e.target.getAttribute("data-exercise-id");
        const setIndex = parseInt(e.target.getAttribute("data-set-index"), 10);
        if (isNaN(setIndex)) return;
        const field = cls.contains("weight-input") ? "weight" : "reps";
        const val = e.target.value;

        if (context === "today") {
          const ex = todayExercises.find(ex => ex.id === exId);
          if (!ex || !ex.sets[setIndex]) return;
          ex.sets[setIndex][field] = val;
          saveToday();
        } else if (context === "routine") {
          const routineId = e.target.getAttribute("data-routine-id");
          const routine = routines.find(r => r.id === routineId);
          if (!routine) return;
          const ex = routine.exercises.find(ex => ex.id === exId);
          if (!ex || !ex.sets[setIndex]) return;
          ex.sets[setIndex][field] = val;
          saveRoutines();
        }
      }
    });

    // ----- VIEW SWITCHING -----
    const todayView = document.getElementById("today-view");
    const routinesView = document.getElementById("routines-view");

    function showTodayView() {
      todayView.style.display = "block";
      routinesView.style.display = "none";
    }

    function showRoutinesView() {
      todayView.style.display = "none";
      routinesView.style.display = "block";
    }

    // ----- INIT -----
    loadState();
    renderToday();
    renderRoutines();
    showTodayView();
  </script>
</body>
</html>