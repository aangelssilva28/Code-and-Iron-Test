<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Code and Iron Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Custom title font (adjust path/name if your file is different) -->
  <style>
    @font-face {
      font-family: "CodeAndIronRough";
      src: url("fonts/CodeAndIronRough.otf") format("opentype");
      font-weight: normal;
      font-style: normal;
    }

    :root {
      --bg-main: #000000;
      --bg-card: #111111;
      --bg-inner: #181818;
      --bg-input: #000000;
      --border-soft: #262626;
      --text-main: #ffffff;
      --text-muted: #b3b3b3;
      --accent-blue: #0a84ff;
      --accent-red: #ff3b30;
      --accent-green: #34c759;
      --set-label: #ffb74d;
      --radius-lg: 22px;
      --radius-md: 16px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.75);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1a1a1a 0, #000 55%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px 16px 40px;
    }

    /* Header / title */

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-top: 4px;
    }

    .app-title {
      font-family: "CodeAndIronRough", system-ui, sans-serif;
      font-size: 32px;
      line-height: 1.1;
      letter-spacing: 0.05em;
      color: #ffffff;
    }

    .menu-button {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      border: 0;
      background: #111111;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-soft);
      cursor: pointer;
    }

    .menu-icon,
    .menu-icon::before,
    .menu-icon::after {
      content: "";
      display: block;
      width: 20px;
      height: 2px;
      border-radius: 999px;
      background: #ffffff;
      position: relative;
    }

    .menu-icon::before {
      position: absolute;
      top: -6px;
    }
    .menu-icon::after {
      position: absolute;
      top: 6px;
    }

    .menu-sheet {
      position: absolute;
      top: 64px;
      right: 16px;
      width: 220px;
      background: #111111;
      border-radius: 18px;
      box-shadow: var(--shadow-soft);
      padding: 8px 0;
      z-index: 20;
      display: none;
    }

    .menu-sheet.open {
      display: block;
    }

    .menu-item-btn {
      width: 100%;
      border: 0;
      background: transparent;
      text-align: left;
      padding: 12px 18px;
      font-size: 18px;
      color: var(--text-main);
      cursor: pointer;
    }

    .menu-item-btn:hover {
      background: #1f1f1f;
    }

    main {
      position: relative;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    /* Section cards */

    .section-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 22px;
      border: 1px solid var(--border-soft);
    }

    .section-header {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .section-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 18px;
    }

    /* Exercise layout */

    .exercise-list {
      display: flex;
      flex-direction: column;
      gap: 18px;
      margin-bottom: 20px;
    }

    .exercise-card {
      background: var(--bg-inner);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      padding: 14px 14px 16px;
    }

    .exercise-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .exercise-name {
      flex: 1;
    }

    .input-field {
      width: 100%;
      border-radius: 14px;
      border: 1px solid #333333;
      background: var(--bg-input);
      color: var(--text-main);
      padding: 10px 12px;
      font-size: 16px;
      outline: none;
    }

    .input-field::placeholder {
      color: var(--text-muted);
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 20px;
      border: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      line-height: 1;
      color: #ffffff;
      cursor: pointer;
      flex-shrink: 0;
    }

    .icon-btn.minus {
      background: var(--accent-red);
    }

    .icon-btn.plus {
      background: var(--accent-blue);
    }

    .icon-btn:active {
      transform: scale(0.96);
    }

    .sets-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 4px;
    }

    .set-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .set-label {
      min-width: 44px;
      font-size: 16px;
      color: var(--set-label);
      font-weight: 600;
    }

    .weight-field,
    .reps-field {
      flex: 1;
    }

    .set-actions {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }

    /* Big CTA buttons */

    .primary-btn {
      width: 100%;
      border-radius: var(--radius-pill);
      border: 0;
      padding: 14px 16px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      color: #ffffff;
      background: var(--accent-blue);
      box-shadow: var(--shadow-soft);
    }

    .primary-btn:active {
      transform: scale(0.97);
    }

    .secondary-link {
      margin-top: 18px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-main);
      font-size: 16px;
      text-decoration: none;
      cursor: pointer;
    }

    .secondary-link span.arrow {
      font-size: 18px;
    }

    /* Routine list */

    .routine-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 18px;
    }

    .routine-card {
      background: var(--bg-inner);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-soft);
      padding: 14px 14px 12px;
    }

    .routine-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .routine-name {
      font-size: 20px;
      font-weight: 700;
    }

    .routine-actions {
      display: flex;
      gap: 8px;
    }

    .pill-btn {
      border-radius: var(--radius-pill);
      border: 0;
      padding: 8px 14px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      color: #ffffff;
      flex-shrink: 0;
    }

    .pill-btn.load {
      background: var(--accent-green);
    }
    .pill-btn.close {
      background: var(--accent-blue);
    }
    .pill-btn.delete {
      background: var(--accent-red);
    }

    .routine-summary {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .routine-preview {
      margin-top: 8px;
    }

    .routine-preview .exercise-card {
      box-shadow: none;
    }

    .routine-preview .input-field {
      opacity: 0.75;
    }

    .routine-preview .icon-btn {
      display: none; /* preview is read-only */
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="app-title">Code and Iron Test</div>
      <button class="menu-button" id="menuToggle" aria-label="Open menu">
        <span class="menu-icon"></span>
      </button>

      <div class="menu-sheet" id="menuSheet">
        <!-- Home removed as requested; only Routines -->
        <button class="menu-item-btn" data-nav-screen="routines">Routines</button>
      </div>
    </header>

    <main>
      <!-- TODAY / LOGGER SCREEN -->
      <section id="todayScreen" class="screen active">
        <div class="section-card">
          <div class="section-header">Today</div>

          <div id="exerciseList" class="exercise-list"></div>

          <button id="addExerciseBtn" class="primary-btn">
            Add exercise
          </button>
        </div>
      </section>

      <!-- ROUTINES SCREEN -->
      <section id="routinesScreen" class="screen">
        <div class="section-card">
          <div class="section-header">Routines</div>
          <div class="section-subtitle">
            Save exercise groups you can quickly load into Today.
          </div>

          <div style="margin-bottom: 10px;">
            <input
              id="routineNameInput"
              class="input-field"
              placeholder="e.g. Push Day, Legs, Back &amp; Biceps"
            />
          </div>

          <button id="saveRoutineBtn" class="primary-btn">
            Save routine
          </button>

          <div id="routineList" class="routine-list"></div>

          <button id="backToLogger" class="secondary-link" type="button">
            <span class="arrow">←</span>
            <span>Back to logger</span>
          </button>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ----- Helpers -----

    const todayScreen = document.getElementById("todayScreen");
    const routinesScreen = document.getElementById("routinesScreen");
    const exerciseListEl = document.getElementById("exerciseList");
    const addExerciseBtn = document.getElementById("addExerciseBtn");
    const menuToggle = document.getElementById("menuToggle");
    const menuSheet = document.getElementById("menuSheet");
    const routineNameInput = document.getElementById("routineNameInput");
    const saveRoutineBtn = document.getElementById("saveRoutineBtn");
    const routineListEl = document.getElementById("routineList");
    const backToLoggerBtn = document.getElementById("backToLogger");

    const ROUTINES_KEY = "codeIronTest_routines";

    function showScreen(which) {
      if (which === "today") {
        todayScreen.classList.add("active");
        routinesScreen.classList.remove("active");
      } else {
        routinesScreen.classList.add("active");
        todayScreen.classList.remove("active");
      }
      menuSheet.classList.remove("open");
    }

    function createSetRow(setIndex, values = {}, readOnly = false) {
      const row = document.createElement("div");
      row.className = "set-row";
      row.innerHTML = `
        <div class="set-label">Set ${setIndex}</div>
        <div class="weight-field">
          <input class="input-field weight-input" placeholder="Weight" ${
            readOnly ? "readonly" : ""
          } value="${values.weight || ""}">
        </div>
        <div class="reps-field">
          <input class="input-field reps-input" placeholder="Reps" ${
            readOnly ? "readonly" : ""
          } value="${values.reps || ""}">
        </div>
        ${
          readOnly
            ? ""
            : `<div class="set-actions">
                 <button class="icon-btn minus" data-action="remove-set">−</button>
                 <button class="icon-btn plus" data-action="add-set">+</button>
               </div>`
        }
      `;
      return row;
    }

    function renumberSets(exerciseCard) {
      const rows = exerciseCard.querySelectorAll(".set-row");
      rows.forEach((row, index) => {
        const label = row.querySelector(".set-label");
        if (label) label.textContent = `Set ${index + 1}`;
      });
    }

    function createExerciseCard(data = {}, readOnly = false) {
      const card = document.createElement("div");
      card.className = "exercise-card";
      card.innerHTML = `
        <div class="exercise-row">
          <div class="exercise-name">
            <input class="input-field exercise-name-input" placeholder="Exercise name" ${
              readOnly ? "readonly" : ""
            } value="${data.name || ""}">
          </div>
          ${
            readOnly
              ? ""
              : `<button class="icon-btn minus" data-action="remove-exercise">−</button>
                 <button class="icon-btn plus" data-action="duplicate-exercise">+</button>`
          }
        </div>
        <div class="sets-list"></div>
      `;

      const setsList = card.querySelector(".sets-list");
      const setsData =
        data.sets && data.sets.length
          ? data.sets
          : [
              {
                weight: "",
                reps: "",
              },
            ];

      setsData.forEach((set, idx) => {
        setsList.appendChild(createSetRow(idx + 1, set, readOnly));
      });

      return card;
    }

    function serializeExercises(rootEl) {
      const exercises = [];
      rootEl.querySelectorAll(".exercise-card").forEach((card) => {
        const nameInput = card.querySelector(".exercise-name-input");
        const sets = [];
        card.querySelectorAll(".set-row").forEach((row) => {
          const weight = row.querySelector(".weight-input")?.value || "";
          const reps = row.querySelector(".reps-input")?.value || "";
          sets.push({ weight, reps });
        });
        exercises.push({
          name: nameInput ? nameInput.value || "" : "",
          sets,
        });
      });
      return exercises;
    }

    function clearChildren(el) {
      while (el.firstChild) el.removeChild(el.firstChild);
    }

    // ----- Today / logger logic -----

    function addNewExercise(data) {
      const card = createExerciseCard(data || {});
      exerciseListEl.appendChild(card);
    }

    addExerciseBtn.addEventListener("click", () => {
      addNewExercise();
    });

    // Event delegation for exercise / set buttons
    exerciseListEl.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const action = btn.dataset.action;

      if (action === "remove-exercise") {
        const card = btn.closest(".exercise-card");
        if (!card) return;
        if (exerciseListEl.children.length === 1) {
          // Always keep at least one exercise card
          card.querySelectorAll("input").forEach((input) => (input.value = ""));
          const setsList = card.querySelector(".sets-list");
          clearChildren(setsList);
          setsList.appendChild(createSetRow(1));
        } else {
          card.remove();
        }
      }

      if (action === "duplicate-exercise") {
        const card = btn.closest(".exercise-card");
        if (!card) return;
        const data = serializeExercises(card.parentElement); // this gives all, but we want just this one
        // simpler: re-read directly from card
        const exerciseData = {
          name:
            card.querySelector(".exercise-name-input")?.value ||
            "",
          sets: [],
        };
        card.querySelectorAll(".set-row").forEach((row) => {
          exerciseData.sets.push({
            weight: row.querySelector(".weight-input")?.value || "",
            reps: row.querySelector(".reps-input")?.value || "",
          });
        });
        addNewExercise(exerciseData);
      }

      if (action === "add-set" || action === "remove-set") {
        const card = btn.closest(".exercise-card");
        const setsList = card.querySelector(".sets-list");
        if (!setsList) return;

        if (action === "add-set") {
          const newRow = createSetRow(setsList.children.length + 1);
          setsList.appendChild(newRow);
        } else if (action === "remove-set") {
          if (setsList.children.length === 1) {
            // Clear the only row
            const firstRow = setsList.children[0];
            firstRow
              .querySelectorAll("input")
              .forEach((input) => (input.value = ""));
          } else {
            setsList.lastElementChild.remove();
          }
        }

        renumberSets(card);
      }
    });

    // ----- Menu / nav -----

    menuToggle.addEventListener("click", () => {
      menuSheet.classList.toggle("open");
    });

    menuSheet.addEventListener("click", (e) => {
      const btn = e.target.closest("[data-nav-screen]");
      if (!btn) return;
      const target = btn.dataset.navScreen;
      if (target === "routines") {
        showScreen("routines");
      }
    });

    backToLoggerBtn.addEventListener("click", () => {
      showScreen("today");
    });

    document.addEventListener("click", (e) => {
      if (
        !menuSheet.contains(e.target) &&
        !menuToggle.contains(e.target)
      ) {
        menuSheet.classList.remove("open");
      }
    });

    // ----- Routines logic -----

    function loadRoutinesFromStorage() {
      try {
        const raw = localStorage.getItem(ROUTINES_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed;
      } catch (err) {
        console.error("Error loading routines", err);
        return [];
      }
    }

    function saveRoutinesToStorage(routines) {
      localStorage.setItem(ROUTINES_KEY, JSON.stringify(routines));
    }

    let routines = loadRoutinesFromStorage();

    function renderRoutines() {
      clearChildren(routineListEl);
      routines.forEach((routine) => {
        const card = document.createElement("div");
        card.className = "routine-card";
        card.dataset.id = routine.id;

        const totalExercises = routine.layout.length;
        const totalSets = routine.layout.reduce(
          (acc, ex) => acc + (ex.sets ? ex.sets.length : 0),
          0
        );

        card.innerHTML = `
          <div class="routine-header-row">
            <div class="routine-name">${routine.name}</div>
            <div class="routine-actions">
              <button class="pill-btn load" data-routine-action="load">Load</button>
              <button class="pill-btn close" data-routine-action="toggle">Close</button>
              <button class="pill-btn delete" data-routine-action="delete">Delete</button>
            </div>
          </div>
          <div class="routine-summary">
            ${totalExercises} exercise${totalExercises !== 1 ? "s" : ""} ·
            ${totalSets} set${totalSets !== 1 ? "s" : ""}
          </div>
          <div class="routine-preview"></div>
        `;

        routineListEl.appendChild(card);

        const previewRoot = card.querySelector(".routine-preview");
        routine.layout.forEach((exercise) => {
          const exCard = createExerciseCard(exercise, true);
          previewRoot.appendChild(exCard);
        });
      });
    }

    saveRoutineBtn.addEventListener("click", () => {
      const name = routineNameInput.value.trim();
      if (!name) {
        alert("Name your routine first.");
        return;
      }

      const layout = serializeExercises(exerciseListEl);
      if (!layout.length) {
        alert("Add at least one exercise before saving.");
        return;
      }

      const newRoutine = {
        id: Date.now(),
        name,
        layout,
      };

      routines.push(newRoutine);
      saveRoutinesToStorage(routines);
      renderRoutines();
      routineNameInput.value = "";
      showScreen("routines");
    });

    routineListEl.addEventListener("click", (e) => {
      const btn = e.target.closest("[data-routine-action]");
      if (!btn) return;

      const action = btn.dataset.routineAction;
      const card = btn.closest(".routine-card");
      if (!card) return;
      const id = Number(card.dataset.id);
      const routine = routines.find((r) => r.id === id);
      if (!routine) return;

      if (action === "load") {
        clearChildren(exerciseListEl);
        routine.layout.forEach((exercise) => {
          const exCard = createExerciseCard(exercise, false);
          exerciseListEl.appendChild(exCard);
        });
        showScreen("today");
        window.scrollTo(0, 0);
      }

      if (action === "delete") {
        routines = routines.filter((r) => r.id !== id);
        saveRoutinesToStorage(routines);
        renderRoutines();
      }

      if (action === "toggle") {
        const preview = card.querySelector(".routine-preview");
        if (!preview) return;
        const hidden = preview.classList.toggle("hidden");
        btn.textContent = hidden ? "Open" : "Close";
      }
    });

    // ----- Initial state -----

    // Make sure there's at least one exercise visible on first load
    if (!exerciseListEl.children.length) {
      addNewExercise();
    }

    renderRoutines();
  </script>
</body>
</html>